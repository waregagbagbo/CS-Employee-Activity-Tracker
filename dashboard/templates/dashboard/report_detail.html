{% extends 'dashboard/base.html' %}

{% block title %}Report #{{ report.id }} - CS Activity Tracker{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h1>Report Details #{{ report.id }}</h1>
    <div>
        {% if not report.approved and user.role in 'supervisor,manager' %}
        <a href="{% url 'dashboard:report_approve' report.id %}" class="btn btn-success">Approve Report</a>
        {% endif %}
        <a href="{% url 'dashboard:report_list' %}" class="btn btn-secondary">← Back to Reports</a>
    </div>
</div>

<!-- Report Status -->
<div class="card mb-3">
    <div class="card-header">Approval Status</div>
    <div class="card-body">
        {% if report.approved %}
        <div style="display: flex; align-items: center; gap: 1rem;">
            <span class="badge badge-success" style="font-size: 1.25rem; padding: 0.5rem 1rem;">✓ Approved</span>
            {% if report.approved_by %}
            <div>
                <div><strong>Approved by:</strong> {{ report.approved_by.get_full_name|default:report.approved_by.email }}</div>
                <div class="text-muted text-small">{{ report.approved_at|date:"l, M d, Y at h:i A" }}</div>
            </div>
            {% endif %}
        </div>
        {% else %}
        <div style="display: flex; align-items: center; gap: 1rem;">
            <span class="badge badge-warning" style="font-size: 1.25rem; padding: 0.5rem 1rem;">⏳ Pending Approval</span>
            <div class="text-muted">This report is awaiting approval from a supervisor or manager.</div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Report Info -->
<div class="card mb-3">
    <div class="card-header">Report Information</div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
            <div>
                <div class="text-muted text-small mb-1">Employee</div>
                <div>
                    <strong>
                        <a href="{% url 'dashboard:employee_detail' report.shift_active_agent.id %}">

                        </a>
                    </strong>
                </div>
            </div>
            <div>
                <div class="text-muted text-small mb-1">Shift Date</div>
                <div><strong>{{ report.shift.date|date:"l, M d, Y" }}</strong></div>
            </div>
            <div>
                <div class="text-muted text-small mb-1">Shift Time</div>
                <div><strong>{{ report.shift.start_time|date:"h:i A" }} - {{ report.shift.end_time|date:"h:i A"|default:"In Progress" }}</strong></div>
            </div>
            <div>
                <div class="text-muted text-small mb-1">Submitted</div>
                <div><strong>{{ report.created_at|date:"M d, Y h:i A" }}</strong></div>
            </div>
        </div>
    </div>
</div>

<!-- Report Content -->
<div class="card mb-3">
    <div class="card-header">Report Content</div>
    <div class="card-body">
        {% if report.summary %}
        <div class="mb-3">
            <strong>Summary:</strong>
            <p style="margin-top: 0.5rem;">{{ report.summary }}</p>
        </div>
        {% endif %}

        {% if report.issues_encountered %}
        <div class="mb-3">
            <strong>Issues Encountered:</strong>
            <p style="margin-top: 0.5rem;">{{ report.issues_encountered }}</p>
        </div>
        {% endif %}

        {% if report.notes %}
        <div class="mb-3">
            <strong>Additional Notes:</strong>
            <p style="margin-top: 0.5rem;">{{ report.notes }}</p>
        </div>
        {% endif %}

        {% if not report.summary and not report.issues_encountered and not report.notes %}
        <div class="empty-state">
            <p class="text-muted">No content provided in this report</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Related Shift -->
<div class="card">
    <div class="card-header">
        Related Shift
        <a href="{% url 'dashboard:shift_detail' report.shift.id %}" class="btn btn-sm btn-primary" style="float: right;">View Shift Details</a>
    </div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div>
                <div class="text-muted text-small">Shift ID</div>
                <div><strong>#{{ report.shift.id }}</strong></div>
            </div>
            <div>
                <div class="text-muted text-small">Date</div>
                <div><strong>{{ report.shift.date|date:"M d, Y" }}</strong></div>
            </div>
            <div>
                <div class="text-muted text-small">Status</div>
                <div>
                    {% if report.shift.status == 'completed' %}
                        <span class="badge badge-success">Completed</span>
                    {% elif report.shift.status == 'in_progress' %}
                        <span class="badge badge-warning">In Progress</span>
                    {% else %}
                        <span class="badge badge-secondary">{{ report.shift.status }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}